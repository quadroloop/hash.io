<!DOCTYPE html>
<html>
<title>Hash.io</title>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="./css/w3.css">
<link rel="stylesheet" href="./css/font-awesome.css">
<link rel="stylesheet" href="./css/node.css">
<link rel="stylesheet" href="./css/animate.css">
<script src="./js/jquery.min.js"></script>
<link rel="icon" href="./img/hash.png">
<script src="./js/popper.js"></script>
<link rel="stylesheet" href="./css/bootstrap.css">
<script src="./js/bootstrap.js"></script>
<!--excel-->
<script src="./dist/cpexcel.js"></script>
<script src="shim.js"></script>
<script src="jszip.js"></script>
<script src="xlsx.js"></script>
</head>

 
<body id="zenbody" spellcheck="false">

<!--loader-->
<div class="loader">
<center>
<h3 class="w3-text-dark-grey w3-center" style="font-size:100px;margin-top:170px;"><img src="./img/hash.png" width="140"> hash.io</h3>
<p class="w3-text-grey thin">Spreadsheet Processing Software | Bryce Mercines 2017</p>
<p class="w3-text-green">loading...</p>
<i class="fa fa-spinner fa-3x w3-text-blue w3-spin"></i>
</center>
</div>

<div class="w3-sidebar w3-bar-block w3-card-4 w3-animate-left w3-small w3-hide-small w3-hide-medium" style="display:none;background-color:rgba(14, 61, 28, 0.97);" id="mySidebar">
    <button class="w3-bar-item w3-button w3-large w3-text-white" onclick="w3_close();sidebar_state++;"><i class="fa fa-map text-light"></i> Menu &times;</button>
    <a class="w3-bar-item w3-text-white"><i class="fa fa-slack w3-text-green"></i> <b class="w3-text-blue">Plug ins</b></a>
    <a id="desktop" class="w3-bar-item w3-text-white w3-button w3-hover-green"><i class="fa fa-th"></i> Student Ledger Manager</a>
    <!--Options-->
    <a class="w3-bar-item w3-text-white"><i class="fa fa-slack w3-text-green"></i> <b class="w3-text-blue">Functions</b></a>
    <a class="w3-bar-item w3-text-white w3-button w3-hover-green" onclick="file_call();"><i class="fa fa-upload"></i> Upload File</a>
    <a class="w3-bar-item w3-text-white w3-button w3-hover-green"><i class="fa fa-music"></i> Mute Audio</a>
    <a class="w3-bar-item w3-text-white w3-button w3-hover-green"><i class="fa fa-indent"></i> option 3</a>
    <a class="w3-bar-item w3-text-white w3-button w3-hover-green"><i class="fa fa-th"></i> option 4</a>
    <a class="w3-bar-item w3-text-white w3-button w3-hover-green"><i class="fa fa-credit-card-alt"></i> option 5</a>
    <a class="w3-bar-item w3-text-white w3-button w3-hover-green"><i class="fa fa-building"></i> option 6</a>
    <a class="w3-bar-item w3-text-white w3-button w3-hover-green"><i class="fa fa-cloud"></i> option 7</a>
</div>

<div zclass="w3-main m-5" id="main" style="overflow:hidden">
<!--document body-->
<div style="display:none;">
<select name="format" onchange="setfmt()">
<option value="csv" selected> CSV</option>
<option value="json"> JSON</option>
<option value="form"> FORMULAE</option>
<option value="html"> HTML</option>
</select>

<textarea id="b64data">... or paste a base64-encoding here</textarea>
<input type="button" id="dotext" value="Click here to process the base64 text" onclick="b64it();"/><br />
<b>Advanced Demo Options:</b>
<!--unchecked to fix webworker bugs
  works if python webserver is open
-->

Use Web Workers: (when available) <input type="checkbox" name="useworker">
Use readAsBinaryString: (when available) <input type="checkbox" name="userabs">
</div>

    <div class="w3-bar w3-white w3-card-2">
        <a class="w3-bar-item" onclick="w3_open()"><i class="fa fa-slack w3-text-green"></i> <b class="w3-text-grey">hash.io</b></a>
        <a class="w3-bar-item w3-text-grey"><i class="fa fa-circle w3-text-blue"></i> Current Mode:  Student Ledger Manager</a>
    </div>
    <div class="row">
        <div class="col-8">
        <!--drop file upload-->
        <div id="drop" class="dropzone" onmouseover="drophover();" onmouseout="dropreset();" onclick="file_call();">
           <img id="dropzone" src="./img/drop.png" class=""><br>
        </div>
          <!--main panel-->
           <div id="main_panel"  spellcheck="false" contenteditable="true" class="w3-input w3-border main-panel" placeholder="Paste Spreadsheet Data Here..">
             <pre id="out"></pre>
             <div id="htmlout"></div>
           </div>           
        </div>
    <div class="col-4">

        <div class="w3-container w3-border mx-2 bg-white w3-hide-small w3-hide-medium" style="height:100%;width:100%;position: fixed;">  
        <!--right bar-->
           <p class="m-2 w3-text-grey"><i class="fa fa-slack w3-text-blue"></i> Dashboard</p>   
           <hr> 
           <div id="dashboard" style="overflow:hidden" class="w3-small w3-text-indigo">
           </div>   
        </div>
    </div>
   </div>


  <div class="w3-bottom mt-4 animated bounceInUp w3-hide-small w3-hide-medium">
    <div class="w3-bar w3-white w3-border">
    <!--
        <button class="btn btn-success m-4 px-3 w3-bar-item" onclick="success();">Convert</button>
        <button class="btn btn-dark m-4 px-3 w3-bar-item" onclick="mcx();">Run</button>
        -->
        <button class="main-btn w3-green w3-bar-item p-3 ml-4 mt-2 mr-2" onclick="sledger();"><i class="fa fa-slack fa-2x"></i></button>
        <input id="xlf" name="xlfile" class="w3-input w3-bar-item w3-margin w3-round w3-border" type="file">
        <input id="searchbar" class="w3-bar-item w3-margin w3-medium" placeholder="Search for Something">
    </div>
  </div>  

<!--SFX from slack-->
 <audio style="display:none;" id="bling">
  <source src="knock_brush.mp3" type="audio/mp3">
  Your browser does not support the audio element.
</audio>

<!--SFX for loaded file -->
 <audio style="display:none;" id="stone">
  <source src="served.mp3" type="audio/mp3">
  Your browser does not support the audio element.
</audio>


<!--end of object bin-->
  

</div>
<script src="./js/sweet_alert.js"></script>

<script src="./js/zennode.js"></script>


<script>
function success() {
  /*
  var x = "Success!";
   swal(
   x,
  'You clicked the button!',
  'success'
  )
*/
 swal({
  title: 'Please Wait',
  text: 'Processing Spreadsheet Data...',
  timer: 1200,
  onOpen: function () {
    swal.showLoading()
  }
}).then(function (result) {
  if (result.dismiss === 'timer') {
    console.log('I was closed by the timer')
  }
})
 }

$(window).load(function() {
    $(".loader").fadeOut("slow");
    w3_open();
})
 </script>

 <!--excel script-->
 <script>
/*jshint browser:true */
/* eslint-env browser */
/*global Uint8Array, console */
/*global XLSX */
var X = XLSX;
var XW = {
  /* worker message */
  msg: 'xlsx',
  /* worker scripts */
  worker: 'xlsxworker.js'
};

var global_wb;

var process_wb = (function() {
  var OUT = document.getElementById('out');
  var HTMLOUT = document.getElementById('htmlout');

  var get_format = (function() {
    var radios = document.getElementsByName( "format" );
    return function() {
      for(var i = 0; i < radios.length; ++i) if(radios[i].checked || radios.length === 1) return radios[i].value;
    };
  })();

  var to_json = function to_json(workbook) {
    var result = {};
    workbook.SheetNames.forEach(function(sheetName) {
      var roa = X.utils.sheet_to_json(workbook.Sheets[sheetName]);
      if(roa.length) result[sheetName] = roa;
    });
    return JSON.stringify(result, 2, 2);
  };

  var to_csv = function to_csv(workbook) {
    var result = [];
    workbook.SheetNames.forEach(function(sheetName) {
      var csv = X.utils.sheet_to_csv(workbook.Sheets[sheetName]);
      if(csv.length){
        result.push("SHEET: " + sheetName);
        result.push("");
        result.push(csv);
      }
    });
    return result.join("\n");
  };

  var to_fmla = function to_fmla(workbook) {
    var result = [];
    workbook.SheetNames.forEach(function(sheetName) {
      var formulae = X.utils.get_formulae(workbook.Sheets[sheetName]);
      if(formulae.length){
        result.push("SHEET: " + sheetName);
        result.push("");
        result.push(formulae.join("\n"));
      }
    });
    return result.join("\n");
  };

  var to_html = function to_html(workbook) {
    HTMLOUT.innerHTML = "";
    workbook.SheetNames.forEach(function(sheetName) {
      var htmlstr = X.write(workbook, {sheet:sheetName, type:'binary', bookType:'html'});
      HTMLOUT.innerHTML += htmlstr;
    });
    return "";
  };

  return function process_wb(wb) {
    global_wb = wb;
    var output = "";
    switch(get_format()) {
      case "form": output = to_fmla(wb); break;
      case "html": output = to_html(wb); break;
      case "json": output = to_json(wb); break;
      default: output = to_csv(wb);
    }
    if(OUT.innerText === undefined) OUT.textContent = output;
    else OUT.innerText = output;
    if(typeof console !== 'undefined') console.log("output", new Date());
  };
})();

var setfmt = window.setfmt = function setfmt() { if(global_wb) process_wb(global_wb); };

var b64it = window.b64it = (function() {
  var tarea = document.getElementById('b64data');
  return function b64it() {
    if(typeof console !== 'undefined') console.log("onload", new Date());
    var wb = X.read(tarea.value, {type:'base64', WTF:false});
    process_wb(wb);
  };
})();

var do_file = (function() {
  var rABS = typeof FileReader !== "undefined" && (FileReader.prototype||{}).readAsBinaryString;
  var domrabs = document.getElementsByName("userabs")[0];
  if(!rABS) domrabs.disabled = !(domrabs.checked = false);

  var use_worker = typeof Worker !== 'undefined';
  var domwork = document.getElementsByName("useworker")[0];
  if(!use_worker) domwork.disabled = !(domwork.checked = false);

  var xw = function xw(data, cb) {
    var worker = new Worker(XW.worker);
    worker.onmessage = function(e) {
      switch(e.data.t) {
        case 'ready': break;
        case 'e': console.error(e.data.d); break;
        case XW.msg: cb(JSON.parse(e.data.d)); break;
      }
    };
    worker.postMessage({d:data,b:rABS?'binary':'array'});
  };

  return function do_file(files) {
    rABS = domrabs.checked;
    use_worker = domwork.checked;
    var f = files[0];
    var reader = new FileReader();
    reader.onload = function(e) {
      if(typeof console !== 'undefined') console.log("onload", new Date(), rABS, use_worker);
      var data = e.target.result;
      if(!rABS) data = new Uint8Array(data);
      if(use_worker) xw(data, process_wb);
      else process_wb(X.read(data, {type: rABS ? 'binary' : 'array'}));
    };
    if(rABS) reader.readAsBinaryString(f);
    else reader.readAsArrayBuffer(f);
  };
})();

(function() {
  var drop = document.getElementById('drop');
  if(!drop.addEventListener) return;

  function handleDrop(e) {
    e.stopPropagation();
    e.preventDefault();
    do_file(e.dataTransfer.files);
  }

  function handleDragover(e) {
    e.stopPropagation();
    e.preventDefault();
    e.dataTransfer.dropEffect = 'copy';
  }

  drop.addEventListener('dragenter', handleDragover, false);
  drop.addEventListener('dragover', handleDragover, false);
  drop.addEventListener('drop', handleDrop, false);
})();

(function() {
  var xlf = document.getElementById('xlf');
  if(!xlf.addEventListener) return;
  function handleFile(e) { do_file(e.target.files); }
  xlf.addEventListener('change', handleFile, false);
})();
</script>
</body>
</html>
